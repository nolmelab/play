# codec 

코덱은 code / decode로 바이트 변환을 합니다. 
통신에서 바이트 변환은 필수적이고 자주 나타납니다. 

암호화나 URL 인코딩 등 서로 다른 시스템 간에 바이트 배열을 
안전하게 전달하거나 서로 알 수 있는 형식으로 만들어야 하기 때문입니다. 

이와 같은 코덱을 프로토콜에 직접 구현하면 복잡도가 올라가고 
단위 테스트가 어려운 문제가 있습니다. 단위 테스트가 안 되면 
저처럼 버그를 잘 만드는 프로그래머는 안심할 수가 없습니다. 
그리고, 다른 기능들 사이에서 버그가 나오면 잡기 어렵기 때문입니다. 

또 성능 확인과 같이 통신에서 중요한 검증을 거치기도 어렵습니다. 
단위 성능을 미리 확인해 두면 큰 도움이 됩니다. 

## 길이 코덱 

length_delimited는 길이로 구분된이라는 뜻으로 길이 필드 4바이트를 추가하여 
프레임(패킷)을 구분하게 합니다. 

매우 단순한 기능인데 코덱으로 둔 이유는 프로토콜에서 여러 번 구현하지 않고 
재사용할 수 있도록 하기 위해서입니다. 

거의 대부분의 프로토콜을 길이로 구분된 프레임으로 만들어 전달할 수 있기 
때문입니다. 

## sodium 코덱 

소디엄은 소금입니다. libsodium은 안전한 공개키 기반의 키 생성과 교환을 
통해 게임에 딱 맞는 암호화를 구현할 수 있습니다. 인터페이스는 C를 따르지만 
사용법이 매우 단순합니다.

chacha20을 암호화에 주로 사용하는데 xor이 붙은 함수로 암복호화에 모두 
사용할 수 있고 inplace (동일 메모리를 사용한) 암복호화도 지원하고 
패딩이 필요 없어서 입력 길이와 동일한 출력을 제공합니다. 

대신에 키 교환 과정이 있어서 sodium_handshake라는 클래스 안에 
그 기능을 넣습니다. 이렇게 기능으로 분리하고 추상화가 가능하면 추상화를 
하고 단위 테스트로 해당 기능을 확인하는 흐름으로 구현합니다. 



